---
layout: default
title: Shell编程技巧与陷阱
category: linux
tags:
- Shell
---

# 基础

## 读取输入

    cat >  hello.sh<<END

读取用户输入，直到碰到END（自定义终止符号）

## 管道
+ tee 将输入输出到屏幕，并且写入到后面跟的文件中去（**用于保存中间数据**）
+ 管道永远连接标准输出
+ 使用\\来对长Shell语句进行换行

## 重定向
重定向是覆盖写

### `cmd > /dev/null 2>&1` 
所有屏幕上的标准输出内容重定向到销毁机中，`2>&1`，2号管道在1号管道输出（&等价）。

+ 标准输出指向`/dev/null`
+ 2号输出等价与1号输出，使得屏幕上的所有输出（标准输出，错误输出）都重定向到`/dev/null`
+ 如果不做上述操作时，后台执行的该程序会占用标准输出和标准输入，导致无法正常退出

### `cat < a.c > a.c`
结果为空！而不是a.c的内容\n
**原因**: 重定向在底层即为，所有的shell是在底层把所有的文件准备好之后才开始执行，`<`以只读的方式打开a.c，**还没有开始读**，`>`相当于以覆盖的方式`fopen`a.c，此时内容为空，导致读到的内容为空！

### `cat << a.c >> a.c`
死循环！\n
**原因**：追加写，先只读打开a.c，然后追加写打开a.c，当写入内容时，读管道又检测到待读内容，产生死循环

### 重定向之书写顺序
+ `>file 2>&1` 标准输出到file文件中，并让错误输出等价于标准输出：结果全输出到file中
+ `2>&1 > file` 标准输出等价于错误输出， 都指向screen，然后标准输出指向file，错误输出依然指向screen： 结果只有标准输出到file中
 

### `cmd &> /dev/null`
&表示后台执行cmd，

## 循环

    for i in `seq 1 3`; do
        echo $i
    done
    
    # c 风格的for循环，核心为2个括号
    LIMIT=10
    for ((a=1;
        a<=LIMIT;
        a++))
    do
        echo "$a"
    done
    
## 调式
bash -x 和 echo
